/*
 * Syscall for FreeBSD and macOS
 */

.text
	.Lsyscall:
		/*
		 * On x86 the FreeBSD and macOS kernel use
		 * the C calling convention to pass parameters
		 * and the syscall number is placed in %eax.
		 */
		int $0x80
		/*
		 * The carry flag is set when an error occurs.
		 */
		jc .Lerror
		jmp .Lreturn
	.Lerror:
		/*
		 * XXX Some syscalls such as fork return the value in %edx.
		 * This was not considered here because all used syscalls
		 * return the value in %eax.
		 */
		movl %eax, _errno
		movl $-1, %eax
	.Lreturn:
		ret

/*
 * The file syscalls.S is generated by makesyscalls.sh. For each syscall,
 * an entry is created using syscalls.S.template that sets the syscall number
 * in the %eax register.
 */
#include "gen/syscalls.S"
